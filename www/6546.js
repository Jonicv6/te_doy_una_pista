"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6546],{6546:(Q,_,a)=>{a.r(_),a.d(_,{FormsPageModule:()=>Y});var h=a(6895),f=a(4719),c=a(8779),p=a(8425),u=a(655),O=a(3666),M=a(1278),b=a(9115),T=a(1609),v=a(2340),k=a(5226),C=a.n(k),y=a(529),e=a(4650);let Z=(()=>{class n{constructor(t){this.http=t,this.httpHeader=new y.WM({"Content-Type":"application/json"})}sendMail(t){return console.log("ENVIAR CORREO"),console.log(t),this.http.post(v.N.endPoint+v.N.nodemailerPoint,t,{headers:this.httpHeader}).subscribe()}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(y.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var x=a(591);let S=(()=>{class n{constructor(){this.objectSource=new x.X({}),this.$getObjectSource=this.objectSource.asObservable()}sendObjectSource(t){this.objectSource.next(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function F(n,r){if(1&n&&(e.TgZ(0,"ion-select-option",21),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t.name)}}function D(n,r){if(1&n&&(e.TgZ(0,"ion-select-option",21),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.AsE("",t.hour,":",t.minutes,"")}}function A(n,r){1&n&&e._UZ(0,"ion-icon",30)}function E(n,r){1&n&&e._UZ(0,"ion-icon",31)}function R(n,r){1&n&&e._UZ(0,"ion-icon",31)}function N(n,r){1&n&&e._UZ(0,"ion-icon",30)}function J(n,r){if(1&n&&(e.TgZ(0,"ion-card")(1,"ion-card-title"),e._uU(2),e.qZA(),e.TgZ(3,"p"),e._uU(4),e.qZA(),e.TgZ(5,"div",32)(6,"div",33)(7,"span"),e._uU(8),e.qZA(),e._UZ(9,"ion-icon",34),e.qZA(),e.TgZ(10,"p",35),e._uU(11),e.qZA()()()),2&n){const t=r.$implicit;e.xp6(2),e.hij(" ",t.user," "),e.xp6(2),e.Oqu(t.text),e.xp6(4),e.hij(" ",t.score,"/5 "),e.xp6(3),e.Oqu(t.date)}}function H(n,r){if(1&n&&(e.TgZ(0,"p",36),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Oqu(t.env.emptyComments)}}function U(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",22)(1,"ion-button",23),e.NdJ("click",function(){e.CHM(t);const l=e.oxw();return e.KtG(l.readComment())}),e.YNc(2,A,1,0,"ion-icon",24),e.YNc(3,E,1,0,"ion-icon",25),e._uU(4),e.ALo(5,"titlecase"),e.YNc(6,R,1,0,"ion-icon",25),e.YNc(7,N,1,0,"ion-icon",24),e.qZA(),e.TgZ(8,"div",26)(9,"ion-virtual-scroll",27),e.YNc(10,J,12,4,"ion-card",28),e.YNc(11,H,2,1,"p",29),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.closeComment),e.xp6(1),e.Q6J("ngIf",!t.closeComment),e.xp6(1),e.hij(" ",e.lcZ(5,7,t.env.comments)," "),e.xp6(2),e.Q6J("ngIf",!t.closeComment),e.xp6(1),e.Q6J("ngIf",t.closeComment),e.xp6(3),e.Q6J("ngForOf",t.listComments),e.xp6(1),e.Q6J("ngIf",t.listCommentsEmpty)}}let P=(()=>{class n{constructor(t,o,l,s,i,d,m,g,q,L){this.route=t,this.activedRoute=o,this.getParams=l,this.trackDataService=s,this.sportCenterDataService=i,this.reserveDataService=d,this.commentDataService=m,this.datepipe=g,this.loadingCtrl=q,this.emailService=L,this.env=v.N,this.selectDay=void 0,this.minDay=(new Date).toLocaleDateString("en-US"),this.actualHour=(new Date).toLocaleTimeString().split(":")[0],this.defaultHours=v.N.hoursOpen,this.hoursFree=[],this.hoursEmpty=!0,this.tracks=[],this.selectTrack=void 0,this.selectHour=void 0,this.nameReserve=void 0,this.closeComment=!0,this.listComments=[],this.listCommentsEmpty=!1}ngOnInit(){this.getData(),this.localData()}ionViewWillEnter(){this.getData(),this.localData()}getData(){return(0,u.mG)(this,void 0,void 0,function*(){yield this.presentLoading(v.N.textLoading),this.loading.present();let t=this.activedRoute.snapshot.params.id;this.sport=this.activedRoute.snapshot.params.sport,yield this.sportCenterDataService.getSportCenter(t).toPromise().then(o=>{this.sportCenter=o,this.sportCenterName=this.sportCenter.name}),yield this.trackDataService.getTrackSportCenter(t,this.sport).toPromise().then(o=>{this.tracks=o})})}localData(){return(0,u.mG)(this,void 0,void 0,function*(){setTimeout(()=>(0,u.mG)(this,void 0,void 0,function*(){if(null!=localStorage.getItem("profile")){let t=yield JSON.parse(localStorage.getItem("profile"));this.nameReserve=t.name}this.loading.dismiss()}),1500)})}presentLoading(t){return(0,u.mG)(this,void 0,void 0,function*(){this.loading=yield this.loadingCtrl.create({message:t,duration:750})})}changeTrack(t){this.selectTrack=t,this.selectDay=void 0,this.hoursFree=[],this.checkHoursEmpty(),this.loadComment()}activeHour(){if(null==this.selectTrack)C().fire({title:this.env.titleErrorSelectDay,text:this.env.errorSelectDay,icon:"error",heightAuto:!1}),this.selectDay=void 0;else{this.selectHour=void 0;let t=this.datepipe.transform(this.selectDay,"dd-MM-yyyy");this.reserveDataService.getReservesForTrackDate(this.selectTrack.idTrack,t).subscribe(o=>(0,u.mG)(this,void 0,void 0,function*(){let l=o,s=[];for(let m of l)s.push(m.hour.split(":")[0]);let d,i=[];switch(this.selectTrack.type){case"Vertical":d="Horizontal";break;case"Horizontal":d="Vertical"}yield this.reserveDataService.getHourReservesForSportCenterDateType(this.sportCenter.idSportCenter,t,d).toPromise().then(m=>{for(let g in m)i.push(m[g].hour.split(":")[0])}),this.hoursFree=[];for(let m of this.defaultHours){let g=this.datepipe.transform(this.minDay,"dd-MM-yyyy");g!==t||s.includes(m.hour)||i.includes(m.hour)&&0!=i.length?g!=this.selectDay&&!s.includes(m.hour)&&!i.includes(m.hour)&&this.hoursFree.push(m):Number.parseInt(m.hour)>=Number.parseInt(this.actualHour.toString())+2&&this.hoursFree.push(m)}this.checkHoursEmpty()}))}}changeHour(t){this.selectHour=t.hour+":"+t.minutes,console.log(this.selectHour)}checkHoursEmpty(){0==this.hoursFree.length&&null!=this.selectDay?this.hoursEmpty=!0:null!=this.selectDay?(document.getElementById("hourPicker").style.visibility="visible",this.hoursEmpty=!1):(document.getElementById("hourPicker").style.visibility="hidden",this.hoursEmpty=!0)}checkReserve(){return(0,u.mG)(this,void 0,void 0,function*(){if(null==this.selectTrack||null==this.selectDay||null==this.selectHour||null==this.nameReserve)C().fire({title:this.env.titleErrorDataReserve,text:this.env.errorDataReserve,icon:"error",heightAuto:!1});else{let t=this.datepipe.transform(this.selectDay,"dd-MM-yyyy"),o={track:this.selectTrack.idTrack,date:t,hour:this.selectHour,user:this.nameReserve};(yield this.checkDateReserveEmpty(o))?this.reserveDataService.createReserve(o).subscribe(s=>(0,u.mG)(this,void 0,void 0,function*(){let i=[];null!=JSON.parse(localStorage.getItem("reserves"))&&(i=JSON.parse(localStorage.getItem("reserves"))),i.push({idReserve:s.idReserve,sportCenter:this.sportCenter,track:this.selectTrack,date:t,hour:this.selectHour,user:this.nameReserve}),localStorage.setItem("reserves",JSON.stringify(i)),console.log("ANTES DE ENVIAR CORREO"),yield this.emailService.sendMail({from:"Nueva Reserva",to:"jonicv_6@hotmail.com",subject:"Nueva reserva realizada",text:"Se ha realizado una nueva reserva",html:"<table><th>TABLA DE LA RESERVA</th></table>"}),console.log("DESPUES DE ENVIAR CORREO"),C().fire({title:this.env.titleSuccessReserve,text:this.env.successReserve,icon:"success",heightAuto:!1}),this.route.navigateByUrl("tabs/reserve")})):C().fire({title:this.env.titleErrorReserve,text:this.env.errorReserve,icon:"error",heightAuto:!1})}})}checkDateReserveEmpty(t){return(0,u.mG)(this,void 0,void 0,function*(){let o;switch(this.selectTrack.type){case"Vertical":o="Horizontal";break;case"Horizontal":o="Vertical"}let l=[];return yield this.reserveDataService.getHourReservesForSportCenterDateType(this.sportCenter.idSportCenter,t.date,o).toPromise().then(s=>{let i=s.filter(function(d){if(d.hour===t.hour)return d.hour});0!=i.length&&l.push(i)}),yield this.reserveDataService.getReservesForTrackDate(t.track,t.date).toPromise().then(s=>{let i=s.filter(function(d){if(d.hour===t.hour)return d.hour});0!=i.length&&l.push(i)}),0==l.length})}readComment(){this.closeComment=!this.closeComment;let t=document.getElementById("comments");t.classList.toggle("openComment"),t.classList.toggle("closeComment");let o=document.getElementById("containerComment");o.classList.toggle("moveButtonOpen"),o.classList.toggle("moveButtonClose")}loadComment(){return(0,u.mG)(this,void 0,void 0,function*(){this.listComments=[],this.listComments=yield this.commentDataService.getComments(this.selectTrack).toPromise(),0!=this.listComments.length?(this.listCommentsEmpty=!1,console.log(this.listComments),this.listComments.sort((t,o)=>this.orderArrayDate(t,o))):this.listCommentsEmpty=!0})}orderArrayDate(t,o){let l=t.date.split("-"),s=o.date.split("-"),i=new Date(Number(l[2]),Number(l[1]),Number(l[0]));return new Date(Number(s[2]),Number(s[1]),Number(s[0])).getTime()-i.getTime()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(p.F0),e.Y36(p.gz),e.Y36(S),e.Y36(b.l),e.Y36(M.x),e.Y36(O.V),e.Y36(T.Z),e.Y36(h.uU),e.Y36(c.HT),e.Y36(Z))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-forms"]],decls:50,vars:34,consts:[["href","https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css","rel","stylesheet","integrity","sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl","crossorigin","anonymous"],["slot","start"],["id","backButton","defaultHref","/",3,"text"],[3,"fullscreen"],[1,"ml-3","text-center"],["id","infoform","action",""],["id","contentInfo"],["aria-label",".form-select-sm ","interface","popover","id","trackPicker",1,"form-select","form-select-sm",3,"placeholder","ionChange"],["trackSelect",""],[3,"value",4,"ngFor","ngForOf"],[1,"select"],["type","date","id","datePicker",3,"ngModel","min","ngModelChange","change"],[1,"select",3,"hidden"],["interface","popover","aria-label",".form-select-sm ","id","hourPicker",1,"form-select","form-select-sm",3,"placeholder","ionChange"],["hourSelect",""],["id","messageHours",3,"hidden"],[1,"nameReserve",3,"hidden"],["type","text",1,"form-control",3,"ngModel","placeholder","ngModelChange"],["id","blockButton",3,"hidden"],["id","buttonForms","color","tertiary",3,"click"],["id","containerComment","class","moveButtonClose",4,"ngIf"],[3,"value"],["id","containerComment",1,"moveButtonClose"],["id","buttonComments","expand","block","color","primary",3,"click"],["name","caret-up-outline",4,"ngIf"],["name","caret-down-outline",4,"ngIf"],["id","comments",1,"closeComment"],["id","scrollComments"],[4,"ngFor","ngForOf"],["id","emptyComment",4,"ngIf"],["name","caret-up-outline"],["name","caret-down-outline"],["id","infoComment"],["id","scoreComment"],["name","star"],["id","dateComment"],["id","emptyComment"]],template:function(t,o){if(1&t){const l=e.EpF();e.TgZ(0,"ion-header"),e._UZ(1,"link",0),e.TgZ(2,"ion-toolbar")(3,"ion-buttons",1),e._UZ(4,"ion-back-button",2),e.qZA()()(),e.TgZ(5,"ion-content",3)(6,"h3",4),e._uU(7),e.qZA(),e.TgZ(8,"h5",4),e._uU(9),e.qZA(),e.TgZ(10,"div",5)(11,"div",6),e._UZ(12,"br"),e.TgZ(13,"div")(14,"ion-label"),e._uU(15),e.ALo(16,"titlecase"),e.qZA(),e.TgZ(17,"ion-select",7,8),e.NdJ("ionChange",function(){e.CHM(l);const i=e.MAs(18);return e.KtG(o.changeTrack(i.value))}),e.YNc(19,F,2,2,"ion-select-option",9),e.qZA()(),e._UZ(20,"br"),e.TgZ(21,"div",10)(22,"ion-label"),e._uU(23),e.ALo(24,"titlecase"),e.qZA(),e.TgZ(25,"input",11),e.NdJ("ngModelChange",function(i){return o.selectDay=i})("change",function(){return o.activeHour()}),e.ALo(26,"date"),e.qZA()(),e._UZ(27,"br"),e.TgZ(28,"div",12)(29,"ion-label"),e._uU(30),e.ALo(31,"titlecase"),e.qZA(),e.TgZ(32,"ion-select",13,14),e.NdJ("ionChange",function(){e.CHM(l);const i=e.MAs(33);return e.KtG(o.changeHour(i.value))}),e.YNc(34,D,2,3,"ion-select-option",9),e.qZA()(),e.TgZ(35,"p",15),e._uU(36),e.qZA(),e._UZ(37,"br")(38,"br")(39,"br"),e.TgZ(40,"div",16)(41,"ion-label"),e._uU(42),e.qZA(),e._UZ(43,"br"),e.TgZ(44,"input",17),e.NdJ("ngModelChange",function(i){return o.nameReserve=i}),e.qZA()()(),e.TgZ(45,"div",18)(46,"ion-button",19),e.NdJ("click",function(){return o.checkReserve()}),e._uU(47),e.ALo(48,"titlecase"),e.qZA()(),e.YNc(49,U,12,9,"div",20),e.qZA()()}2&t&&(e.xp6(4),e.Q6J("text",o.env.back),e.xp6(1),e.Q6J("fullscreen",!0),e.xp6(2),e.Oqu(o.sportCenterName),e.xp6(2),e.Oqu(o.sport),e.xp6(6),e.Oqu(e.lcZ(16,23,o.env.track)),e.xp6(2),e.s9C("placeholder",o.env.selectTrack),e.xp6(2),e.Q6J("ngForOf",o.tracks),e.xp6(4),e.Oqu(e.lcZ(24,25,o.env.date)),e.xp6(2),e.Q6J("ngModel",o.selectDay)("min",e.xi3(26,27,o.minDay,"yyyy-MM-dd")),e.xp6(3),e.Q6J("hidden",o.hoursEmpty),e.xp6(2),e.Oqu(e.lcZ(31,30,o.env.hour)),e.xp6(2),e.s9C("placeholder",o.env.selectHour),e.xp6(2),e.Q6J("ngForOf",o.hoursFree),e.xp6(1),e.Q6J("hidden",!o.hoursEmpty),e.xp6(1),e.Oqu(o.env.emptyHours),e.xp6(4),e.Q6J("hidden",o.hoursEmpty),e.xp6(2),e.Oqu(o.env.reserveName),e.xp6(2),e.s9C("placeholder",o.env.yourName),e.Q6J("ngModel",o.nameReserve),e.xp6(1),e.Q6J("hidden",o.hoursEmpty),e.xp6(2),e.Oqu(e.lcZ(48,32,o.env.reserver)),e.xp6(2),e.Q6J("ngIf",null!=o.selectTrack))},dependencies:[h.sg,h.O5,f.Fj,f.JJ,f.On,c.oU,c.YG,c.Sm,c.PM,c.Dq,c.W2,c.Gu,c.gu,c.Q$,c.t9,c.n0,c.sr,c.QI,c.cs,c.aJ,h.rS,h.uU],styles:["#backButton[_ngcontent-%COMP%]{background-color:#1e90ff;border-radius:20px;color:#fff;padding:0 5px}ion-toolbar[_ngcontent-%COMP%]{--background: transparent !important}.header-md[_ngcontent-%COMP%]:after{visibility:hidden!important}h3[_ngcontent-%COMP%]{color:var(--ion-color-tertiary)}ion-content[_ngcontent-%COMP%]{--overflow: hidden;--ion-background-color: var(--ion-color-secondary)}#infoform[_ngcontent-%COMP%]{padding:0 5%;height:100%}#trackPicker[_ngcontent-%COMP%]{float:right;height:30px;width:75%}ion-select[_ngcontent-%COMP%]{color:#000}ion-select[_ngcontent-%COMP%]::part(icon){display:none!important}ion-label[_ngcontent-%COMP%]{color:#fff}.select[_ngcontent-%COMP%] > ion-label[_ngcontent-%COMP%]{width:25%;float:left;padding-right:15px}.select[_ngcontent-%COMP%] > ion-select[_ngcontent-%COMP%]{margin-right:5px}.select[_ngcontent-%COMP%] > ion-datetime[_ngcontent-%COMP%]{width:70%;float:right;padding:0}#datePicker[_ngcontent-%COMP%]{padding:0 5px;background:rgba(255,255,255,.3882352941);color:#000;border-radius:5px}#hourPicker[_ngcontent-%COMP%]{color:#000!important;visibility:hidden;height:30px;width:75%}.nameReserve[_ngcontent-%COMP%]{width:100%;text-align-last:center;text-align:center;margin-bottom:5%}.nameReserve[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], #blockButton[_ngcontent-%COMP%]{text-align:center}#buttonForms[_ngcontent-%COMP%]{--ion-color-contrast: black !important}#buttonComments[_ngcontent-%COMP%]{--ion-color-contrast: white !important;margin:0 -20px;z-index:3}#messageHours[_ngcontent-%COMP%]{text-align:center}.openComment[_ngcontent-%COMP%]{position:fixed;width:100%;height:100%;background-color:var(--ion-color-tertiary)!important;margin:inherit;left:5%;right:5%;padding:0}.closeComment[_ngcontent-%COMP%]{height:0}.moveButtonOpen[_ngcontent-%COMP%]{position:absolute;top:15%;width:100%;margin:0 -18px;transition:all 1s linear;z-index:2}.moveButtonClose[_ngcontent-%COMP%]{position:absolute;bottom:55px;width:100%;margin:0 -18px;transition:all 1s linear;z-index:2}.hide[_ngcontent-%COMP%]{height:0px}#scrollComments[_ngcontent-%COMP%]{background-color:var(--ion-color-tertiary)!important;height:80%!important;overflow:auto;padding-bottom:3%}#scrollComments[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{color:#000!important;text-align:center;margin-top:25%}ion-card[_ngcontent-%COMP%]{background-color:var(--ion-color-secondary);padding:10px}ion-card-title[_ngcontent-%COMP%]{color:#fff}ion-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-tertiary)}ion-card[_ngcontent-%COMP%]   #infoComment[_ngcontent-%COMP%]{clear:both}ion-card[_ngcontent-%COMP%]   #dateComment[_ngcontent-%COMP%]{margin-bottom:0;margin-top:10px;float:right;color:#fff}ion-card[_ngcontent-%COMP%]   #scoreComment[_ngcontent-%COMP%]{font-size:x-large;float:left}ion-card[_ngcontent-%COMP%]   #scoreComment[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{vertical-align:top;color:#fff}ion-card[_ngcontent-%COMP%]   #scoreComment[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{padding-top:1px;vertical-align:text-top;color:var(--ion-color-tertiary)}"]}),n})();const I=[{path:"",component:P}];let B=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[p.Bz.forChild(I),p.Bz]}),n})(),Y=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[h.ez,f.u5,c.Pc,B,p.Bz.forChild([{path:"",component:P}])]}),n})()}}]);